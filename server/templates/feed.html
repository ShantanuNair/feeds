<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="/static/{{ 'app.css'|cachebust }}">
    <script src="/static/jquery-3.5.1.min.js"></script>
    <script>
      const pageSettings = {
        feedId: {{ feed_id|tojson|safe }},
        lastTimestamp: {{ last_timestamp|tojson|safe }},
      }
    </script>
    <script src="/static/{{ 'app.js'|cachebust }}"></script>
    <title>Scanner - {{ feed.name }}</title>
  </head>
  <body>
    <div id="alert-box" style="display: none"></div>
    <h3>Scanner - {{ feed.name }}</h1>
    <a href="/">&lt- feed list</a>

    <script type="text/javascript">
        var upvotes = parseInt(localStorage.getItem('upvotes'));
        if (isNaN(upvotes)) {
          upvotes = 0;
          window.localStorage.setItem('upvotes', 0);
        }

        var downvotes = parseInt(localStorage.getItem('downvotes'));
        if (isNaN(downvotes)) {
          downvotes = 0;
          window.localStorage.setItem('downvotes', 0);
        }

        var fixes = parseInt(localStorage.getItem('fixes'));
        if (isNaN(fixes)) {
          fixes = 0;
          window.localStorage.setItem('fixes', 0);
        }

        document.write(`
    <div class="feed-help">
    <p>Help us improve our transcriptions! Click the buttons to let us know:</p>
    <ul>
      <li>üîä to listen and fix a transcription</li>
      <li>üëç if a transcription is accurate</li>
      <li>üëé if a transcription is inaccurate</li>
    </ul>
    <p>Your contributions</p>
    <ul>
      <li><span id="number-fixes">` + fixes + `</span> transcriptions fixed</li>
      <li><span id="number-upvotes">` + upvotes + `</span> upvotes</li>
      <li><span id="number-downvotes">` + downvotes + `</span> downvotes</li>
    </ul>
    </div>`)
    </script>

    <ul id="entries">
      {% for c in calls %}
        <li class="call" id="call-{{ c._id }}" data-id="{{ c._id }} ">
          <div class="buttons button toggle">üîä</div>
          <time>{{ c.ts.strftime('%-m/%-d/%Y %H:%M:%S') }}</time>
          {% if not c.transcriptions %}
          <div class="message" data-id="{{ best._id }}">
            <span class="score">(?)</span>{#
            #}<span class="source-icon">‚ùî</span>{#
            #}<span class="transcription-text"></span>
          </div>
          {% else %}
          {% set best = c.transcriptions[0] %}
          <div class="message" data-id="{{ best._id }}">
            <span class="score">({{ best.upvotes - best.downvotes }})</span>{#
            #}<span class="source-icon">{% if best.source == "user" %}üë§{% else %}ü§ñ{% endif %}</span>{#
            #}<span class="transcription-text">{{ best.text }}</span>
          </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </body>
</html>
